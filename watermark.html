<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Image Watermark Tool</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f9f9f9;
        margin: 0; padding: 20px;
        color: #333;
    }
    h1 { text-align: center; margin-bottom: 20px; }
    .container { max-width: 1100px; margin: auto; }
    .controls {
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        margin-bottom: 20px;
    }
    label { font-weight: bold; display: block; margin-top: 10px; }
    input, select, button {
        margin-top: 5px;
        padding: 6px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }
    input[type=color] { padding: 0; border: none; background: none; }
    button {
        background: #4CAF50;
        color: white;
        cursor: pointer;
    }
    button:hover { background: #45a049; }
    .preview-area {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }
    .preview {
        background: white;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        text-align: center;
    }
    canvas {
        max-width: 300px;
        border: 1px solid #ddd;
    }
    .watermark-entry {
        background: #f2f2f2;
        padding: 8px;
        border-radius: 4px;
        margin-bottom: 10px;
    }
</style>
</head>
<body>
<div class="container">
    <h1>Image Watermark Tool</h1>

    <div class="controls">
        <label>Select Images:</label>
        <input type="file" id="imageInput" accept="image/*" multiple>

        <label>Watermarks:</label>
        <div id="watermarks"></div>
        <button type="button" onclick="addWatermark()">+ Add Watermark</button>

        <label>Optional Logo:</label>
        <input type="file" id="logoInput" accept="image/*">

        <button type="button" onclick="downloadAll()">Download All</button>
    </div>

    <div class="preview-area" id="previewArea"></div>
</div>

<script>
let images = [];
let logo = null;
let watermarks = [];

function addWatermark() {
    const wm = {
        text: 'Sample Watermark',
        size: 24,
        color: '#000000',
        opacity: 0.5,
        angle: 0,
        posX: 50,
        posY: 50
    };
    watermarks.push(wm);
    renderWatermarkControls();
    drawAllPreviews();
}

function renderWatermarkControls() {
    const container = document.getElementById('watermarks');
    container.innerHTML = '';
    watermarks.forEach((wm, index) => {
        const div = document.createElement('div');
        div.className = 'watermark-entry';
        div.innerHTML = `
            <label>Text:</label>
            <input type="text" value="${wm.text}" onchange="updateWM(${index}, 'text', this.value)">
            <label>Size:</label>
            <input type="number" value="${wm.size}" onchange="updateWM(${index}, 'size', this.value)">
            <label>Color:</label>
            <input type="color" value="${wm.color}" onchange="updateWM(${index}, 'color', this.value)">
            <label>Opacity (0-1):</label>
            <input type="number" step="0.1" value="${wm.opacity}" onchange="updateWM(${index}, 'opacity', this.value)">
            <label>Angle (deg):</label>
            <input type="number" value="${wm.angle}" onchange="updateWM(${index}, 'angle', this.value)">
            <label>Position X%:</label>
            <input type="number" value="${wm.posX}" onchange="updateWM(${index}, 'posX', this.value)">
            <label>Position Y%:</label>
            <input type="number" value="${wm.posY}" onchange="updateWM(${index}, 'posY', this.value)">
            <button onclick="removeWM(${index})">Remove</button>
        `;
        container.appendChild(div);
    });
}

function updateWM(index, key, value) {
    watermarks[index][key] = isNaN(value) ? value : Number(value);
    drawAllPreviews();
}

function removeWM(index) {
    watermarks.splice(index, 1);
    renderWatermarkControls();
    drawAllPreviews();
}

document.getElementById('imageInput').addEventListener('change', function(e) {
    images = [];
    const files = e.target.files;
    let loaded = 0;
    for (let file of files) {
        const reader = new FileReader();
        reader.onload = function(evt) {
            const img = new Image();
            img.onload = function() {
                images.push(img);
                loaded++;
                if (loaded === files.length) drawAllPreviews();
            };
            img.src = evt.target.result;
        };
        reader.readAsDataURL(file);
    }
});

document.getElementById('logoInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) { logo = null; drawAllPreviews(); return; }
    const reader = new FileReader();
    reader.onload = function(evt) {
        const img = new Image();
        img.onload = function() {
            logo = img;
            drawAllPreviews();
        };
        img.src = evt.target.result;
    };
    reader.readAsDataURL(file);
});

function drawAllPreviews() {
    const area = document.getElementById('previewArea');
    area.innerHTML = '';
    images.forEach((img, idx) => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = img.width;
        canvas.height = img.height;

        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0);

        watermarks.forEach(wm => {
            ctx.save();
            ctx.globalAlpha = wm.opacity;
            ctx.fillStyle = wm.color;
            ctx.font = `${wm.size}px Arial`;
            ctx.translate(canvas.width * wm.posX / 100, canvas.height * wm.posY / 100);
            ctx.rotate(wm.angle * Math.PI / 180);
            ctx.textAlign = 'center';
            ctx.fillText(wm.text, 0, 0);
            ctx.restore();
        });

        if (logo) {
            ctx.globalAlpha = 1;
            const logoSize = Math.min(canvas.width, canvas.height) / 5;
            ctx.drawImage(logo, canvas.width - logoSize - 10, canvas.height - logoSize - 10, logoSize, logoSize);
        }

        const div = document.createElement('div');
        div.className = 'preview';
        div.appendChild(canvas);
        area.appendChild(div);
    });
}

function downloadAll() {
    images.forEach((img, idx) => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = img.width;
        canvas.height = img.height;

        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0);

        watermarks.forEach(wm => {
            ctx.save();
            ctx.globalAlpha = wm.opacity;
            ctx.fillStyle = wm.color;
            ctx.font = `${wm.size}px Arial`;
            ctx.translate(canvas.width * wm.posX / 100, canvas.height * wm.posY / 100);
            ctx.rotate(wm.angle * Math.PI / 180);
            ctx.textAlign = 'center';
            ctx.fillText(wm.text, 0, 0);
            ctx.restore();
        });

        if (logo) {
            ctx.globalAlpha = 1;
            const logoSize = Math.min(canvas.width, canvas.height) / 5;
            ctx.drawImage(logo, canvas.width - logoSize - 10, canvas.height - logoSize - 10, logoSize, logoSize);
        }

        const link = document.createElement('a');
        link.download = `watermarked_${idx+1}.png`;
        link.href = canvas.toDataURL();
        link.click();
    });
}

addWatermark();
</script>
</body>
</html>
